<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>
	<video src='./test.webm' controls id='movies' autoplay oncanplay='startVideo()' onended='stopTimeline()'>
		<object data='videoplayer.swf' type='application/x-shockwave-flash'>
			<param name="movie" value="video.swf">
		</object>
	</video>

	<canvas id='timeline' width='400px' height='300px'>
		
	</canvas>
</body>

<script type="text/javascript">
//设置帧更新的间隔
	var updateInterval = 5000;

//时序中帧的尺寸	
	var frameWidth = 100;
	var frameHeight = 75;

//时序的总帧数
	var frameRows = 4;
	var frameColumns = 4;
	var frameGrid = frameRows * frameColumns;	

//当前帧
	var frameCount = 0;

//播放完后取消计时器
    var intervalId;
	var videoStarted = false;

	function startVideo() {
		//确保第一次播放才触发
		if(videoStarted) {
			return
		}
		videoStarted = true;

		updateFrame();
		intervalId = setInterval(updateFrame, updateInterval);

		var timeline = document.getElementById('timeline');
		timeline.onclick = function(evt) {
			var video = document.getElementById('movies');
            //计算出第几个，0开始计算
			var offX = evt.layerX;
			var offY = evt.layerY;
			var clickedFrame = Math.floor(offY / frameHeight) * frameRows;
			clickedFrame += Math.floor(offX / frameWidth) ;
            
			var totalTimes = Math.floor(frameCount / 16) * 16 + clickedFrame;
			if(clickedFrame > (frameCount % 16)) {
				totalTimes -= 16;
			}
			
			video.currentTime = totalTimes * updateInterval / 1000;
		}
	}

//把帧绘制到画布上
	function updateFrame() {
		var video = document.getElementById('movies');
		var timeline = document.getElementById('timeline');
       
        var ctx = timeline.getContext('2d');
        //当前播放位置
        var framePosition = frameCount % frameGrid;
        var frameX = (framePosition % frameColumns) * frameWidth;
        var frameY = (Math.floor(framePosition / frameRows)) * frameHeight;
        //canvas的绘制程序可以将视频源当作图像绘制
        ctx.drawImage(video, 0, 0, 400, 300, frameX, frameY, frameWidth, frameHeight);

        frameCount++;
	}
	function stopTimeline() {
		clearInterval(intervalId);
	}

</script>
</html>		